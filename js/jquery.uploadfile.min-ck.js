/*!
 * jQuery Upload File Plugin
 * version: 3.1.4
 * @requires jQuery v1.5 or later & form plugin
 * Copyright (c) 2013 Ravishanker Kusuma
 * http://hayageek.com/
 *//*!
 * jQuery Upload File Plugin
 * version: 3.1.4
 * @requires jQuery v1.5 or later & form plugin
 * Copyright (c) 2013 Ravishanker Kusuma
 * http://hayageek.com/
 */(function(e){e.fn.ajaxForm==undefined&&e.getScript("http://malsup.github.io/jquery.form.js");var t={};t.fileapi=e("<input type='file'/>").get(0).files!==undefined;t.formdata=window.FormData!==undefined;e.fn.uploadFile=function(n){function a(){if(r.afterUploadAll&&!u){u=!0;(function e(){if(s.sCounter!=0&&s.sCounter+s.fCounter==s.tCounter){r.afterUploadAll(s);u=!1}else window.setTimeout(e,100)})()}}function f(t,n,r){r.on("dragenter",function(t){t.stopPropagation();t.preventDefault();e(this).css("border","2px solid #A5A5C7")});r.on("dragover",function(e){e.stopPropagation();e.preventDefault()});r.on("drop",function(r){e(this).css("border","2px dotted #A5A5C7");r.preventDefault();t.errorLog.html("");var i=r.originalEvent.dataTransfer.files;if(!n.multiple&&i.length>1){n.showError&&e("<div style='color:red;'>"+n.multiDragErrorStr+"</div>").appendTo(t.errorLog);return}if(n.onSelect(i)==0)return;h(n,t,i)});e(document).on("dragenter",function(e){e.stopPropagation();e.preventDefault()});e(document).on("dragover",function(e){e.stopPropagation();e.preventDefault();r.css("border","2px dotted #A5A5C7")});e(document).on("drop",function(e){e.stopPropagation();e.preventDefault();r.css("border","2px dotted #A5A5C7")})}function l(e){var t="",n=e/1024;if(parseInt(n)>1024){var r=n/1024;t=r.toFixed(2)+" MB"}else t=n.toFixed(2)+" KB";return t}function c(t){var n=[];jQuery.type(t)=="string"?n=t.split("&"):n=e.param(t).split("&");var r=n.length,i=[],s,o;for(s=0;s<r;s++){n[s]=n[s].replace(/\+/g," ");o=n[s].split("=");i.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])])}return i}function h(t,n,r){for(var i=0;i<r.length;i++){if(!p(n,t,r[i].name)){t.showError&&e("<div style='color:red;'><b>"+r[i].name+"</b> "+t.extErrorStr+t.allowedTypes+"</div>").appendTo(n.errorLog);continue}if(t.maxFileSize!=-1&&r[i].size>t.maxFileSize){t.showError&&e("<div style='color:red;'><b>"+r[i].name+"</b> "+t.sizeErrorStr+l(t.maxFileSize)+"</div>").appendTo(n.errorLog);continue}if(t.maxFileCount!=-1&&n.selectedFiles>=t.maxFileCount){t.showError&&e("<div style='color:red;'><b>"+r[i].name+"</b> "+t.maxFileCountErrorStr+t.maxFileCount+"</div>").appendTo(n.errorLog);continue}n.selectedFiles++;var s=t,o=new FormData,u=t.fileName.replace("[]","");o.append(u,r[i]);var a=t.formData;if(a){var f=c(a);for(var h=0;h<f.length;h++)f[h]&&o.append(f[h][0],f[h][1])}s.fileData=o;var d=new m(n,t),v="";t.showFileCounter?v=n.fileCounter+t.fileCounterStyle+r[i].name:v=r[i].name;d.filename.html(v);var y=e("<form style='display:block; position:absolute;left: 150px;' class='"+n.formGroup+"' method='"+t.method+"' action='"+t.url+"' enctype='"+t.enctype+"'></form>");y.appendTo("body");var b=[];b.push(r[i].name);g(y,s,d,b,n);n.fileCounter++}}function p(e,t,n){var r=t.allowedTypes.toLowerCase().split(","),i=n.split(".").pop().toLowerCase();return t.allowedTypes!="*"&&jQuery.inArray(i,r)<0?!1:!0}function d(t,n){if(t.showFileCounter){var r=e(".ajax-file-upload-filename").length;n.fileCounter=r+1;e(".ajax-file-upload-filename").each(function(n,i){var s=e(this).html().split(t.fileCounterStyle),o=parseInt(s[0])-1,u=r+t.fileCounterStyle+s[1];e(this).html(u);r--})}}function v(n,r,i,s){var o="ajax-upload-id-"+(new Date).getTime(),u=e("<form method='"+i.method+"' action='"+i.url+"' enctype='"+i.enctype+"'></form>"),a="<input type='file' id='"+o+"' name='"+i.fileName+"'/>";if(i.multiple){i.fileName.indexOf("[]")!=i.fileName.length-2&&(i.fileName+="[]");a="<input type='file' id='"+o+"' name='"+i.fileName+"' multiple/>"}var f=e(a).appendTo(u);f.change(function(){n.errorLog.html("");var o=i.allowedTypes.toLowerCase().split(","),a=[];if(this.files){for(b=0;b<this.files.length;b++)a.push(this.files[b].name);if(i.onSelect(this.files)==0)return}else{var f=e(this).val(),l=[];a.push(f);if(!p(n,i,f)){i.showError&&e("<div style='color:red;'><b>"+f+"</b> "+i.extErrorStr+i.allowedTypes+"</div>").appendTo(n.errorLog);return}l.push({name:f,size:"NA"});if(i.onSelect(l)==0)return}d(i,n);s.unbind("click");u.hide();v(n,r,i,s);u.addClass(r);if(t.fileapi&&t.formdata){u.removeClass(r);var c=this.files;h(i,n,c)}else{var y="";for(var b=0;b<a.length;b++){i.showFileCounter?y+=n.fileCounter+i.fileCounterStyle+a[b]+"<br>":y+=a[b]+"<br>";n.fileCounter++}if(i.maxFileCount!=-1&&n.selectedFiles+a.length>i.maxFileCount){i.showError&&e("<div style='color:red;'><b>"+y+"</b> "+i.maxFileCountErrorStr+i.maxFileCount+"</div>").appendTo(n.errorLog);return}n.selectedFiles+=a.length;var w=new m(n,i);w.filename.html(y);g(u,i,w,a,n)}});if(i.nestedForms){u.css({margin:0,padding:0});var l=e(s).width();l<=0&&(l=120);var c=s.height();c<=0&&(c=25);s.css({position:"relative",overflow:"hidden",cursor:"default"});f.css({position:"absolute",cursor:"pointer",top:"0px",width:l,height:c,left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"});u.appendTo(s)}else{u.appendTo(e("body"));u.css({margin:0,padding:0,display:"block",position:"absolute",left:"-250px"});navigator.appVersion.indexOf("MSIE ")!=-1?s.attr("for",o):s.click(function(){f.click()})}}function m(t,n){this.statusbar=e("<div class='ajax-file-upload-statusbar'></div>");this.filename=e("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar);this.progressDiv=e("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide();this.progressbar=e("<div class='ajax-file-upload-bar "+t.formGroup+"'></div>").appendTo(this.progressDiv);this.abort=e("<div class='ajax-file-upload-red "+t.formGroup+"'>"+n.abortStr+"</div>").appendTo(this.statusbar).hide();this.cancel=e("<div class='ajax-file-upload-red'>"+n.cancelStr+"</div>").appendTo(this.statusbar).hide();this.done=e("<div class='ajax-file-upload-green'>"+n.doneStr+"</div>").appendTo(this.statusbar).hide();this.del=e("<div class='ajax-file-upload-red'>"+n.deletelStr+"</div>").appendTo(this.statusbar).hide();n.showQueueDiv?e("#"+n.showQueueDiv).append(this.statusbar):t.errorLog.after(this.statusbar);return this}function g(e,n,r,i,s){var o=null,u={cache:!1,contentType:!1,processData:!1,forceSync:!1,type:n.method,data:n.formData,formData:n.fileData,dataType:n.returnType,beforeSubmit:function(t,o,u){if(n.onSubmit.call(this,i)!=0){var f=n.dynamicFormData();if(f){var l=c(f);if(l)for(var h=0;h<l.length;h++)l[h]&&(n.fileData!=undefined?u.formData.append(l[h][0],l[h][1]):u.data[l[h][0]]=l[h][1])}s.tCounter+=i.length;a();return!0}r.statusbar.append("<div style='color:red;'>"+n.uploadErrorStr+"</div>");r.cancel.show();e.remove();r.cancel.click(function(){r.statusbar.remove()});return!1},beforeSend:function(e,o){r.progressDiv.show();r.cancel.hide();r.done.hide();if(n.showAbort){r.abort.show();r.abort.click(function(){e.abort();s.selectedFiles-=i.length})}t.formdata?r.progressbar.width("1%"):r.progressbar.width("5%")},uploadProgress:function(e,t,i,s){s>98&&(s=98);var o=s+"%";s>1&&r.progressbar.width(o);if(n.showProgress){r.progressbar.html(o);r.progressbar.css("text-align","center")}},success:function(t,o,u){s.responses.push(t);r.progressbar.width("100%");if(n.showProgress){r.progressbar.html("100%");r.progressbar.css("text-align","center")}r.abort.hide();n.onSuccess.call(this,i,t,u);if(n.showStatusAfterSuccess){if(n.showDone){r.done.show();r.done.click(function(){r.statusbar.hide("slow");r.statusbar.remove()})}else r.done.hide();if(n.showDelete){r.del.show();r.del.click(function(){r.statusbar.hide().remove();n.deleteCallback&&n.deleteCallback.call(this,t,r);s.selectedFiles-=i.length;d(n,s)})}else r.del.hide()}else{r.statusbar.hide("slow");r.statusbar.remove()}e.remove();s.sCounter+=i.length},error:function(t,o,u){r.abort.hide();if(t.statusText=="abort"){r.statusbar.hide("slow").remove();d(n,s)}else{n.onError.call(this,i,o,u);if(n.showStatusAfterError){r.progressDiv.hide();r.statusbar.append("<span style='color:red;'>ERROR: "+u+"</span>")}else{r.statusbar.hide();r.statusbar.remove()}s.selectedFiles-=i.length}e.remove();s.fCounter+=i.length}};if(n.autoSubmit)e.ajaxSubmit(u);else{if(n.showCancel){r.cancel.show();r.cancel.click(function(){e.remove();r.statusbar.remove();s.selectedFiles-=i.length;d(n,s)})}e.ajaxForm(u)}}var r=e.extend({url:"",method:"POST",enctype:"multipart/form-data",formData:null,returnType:null,allowedTypes:"*",fileName:"file",formData:{},dynamicFormData:function(){return{}},maxFileSize:-1,maxFileCount:-1,multiple:!0,dragDrop:!0,autoSubmit:!0,showCancel:!0,showAbort:!0,showDone:!0,showDelete:!1,showError:!0,showStatusAfterSuccess:!0,showStatusAfterError:!0,showFileCounter:!0,fileCounterStyle:"). ",showProgress:!1,nestedForms:!0,onSelect:function(e){return!0},onSubmit:function(e,t){},onSuccess:function(e,t,n){},onError:function(e,t,n){},deleteCallback:!1,afterUploadAll:!1,uploadButtonClass:"ajax-file-upload",dragDropStr:"",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag &amp; Drop is not allowed.",extErrorStr:"is not allowed. Allowed extensions: ",sizeErrorStr:"is not allowed. Allowed Max size: ",uploadErrorStr:"Upload is not allowed",maxFileCountErrorStr:" is not allowed. Maximum allowed files are:",showQueueDiv:!1},n);this.fileCounter=1;this.selectedFiles=0;this.fCounter=0;this.sCounter=0;this.tCounter=0;var i="ajax-file-upload-"+(new Date).getTime();this.formGroup=i;this.hide();this.errorLog=e("<div></div>");this.after(this.errorLog);this.responses=[];t.formdata||(r.dragDrop=!1);t.formdata||(r.multiple=!1);var s=this,o=e("<div>"+e(this).html()+"</div>");e(o).addClass(r.uploadButtonClass);(function y(){if(e.fn.ajaxForm){if(r.dragDrop){var t=e('<div class="ajax-upload-dragdrop" style="vertical-align:top;"></div>');e(s).before(t);e(t).append(o);e(t).append(e(r.dragDropStr));f(s,r,t)}else e(s).before(o);v(s,i,r,o)}else window.setTimeout(y,10)})();this.startUpload=function(){e("."+this.formGroup).each(function(t,n){e(this).is("form")&&e(this).submit()})};this.stopUpload=function(){e(".ajax-file-upload-red").each(function(t,n){e(this).hasClass(s.formGroup)&&e(this).click()})};this.getResponses=function(){return this.responses};var u=!1;return this}})(jQuery);